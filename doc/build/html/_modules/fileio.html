

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>fileio &mdash; Predictive Clinical Neuroscience Toolkit 0.20 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b76e3c8a" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="../_static/pages/css/pcntoolkit_tabs.css" />
      <link rel="stylesheet" type="text/css" href="../_static/pages/css/pcntoolkit.css" />
      <link rel="stylesheet" type="text/css" href="../_static/pages/css/pcntoolkit_nomaxwidth.css" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=0144e382"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/pcn-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pages/installation.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Background</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pages/pcntoolkit_background.html">PCNtoolkit Background</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Function &amp; Class Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pages/modindex.html">Module Index</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pages/normative_modelling_walkthrough.html"><strong>DEMO ON NORMATIVE MODELING</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/HBR_NormativeModel_FCONdata_Tutorial.html">Predictive Clinical Neuroscience Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/HBR_NormativeModel_FCONdata_Tutorial.html#hierarchical-bayesian-regression-normative-modelling-and-transfer-onto-unseen-site">Hierarchical Bayesian Regression Normative Modelling and Transfer onto unseen site.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/apply_normative_models.html">Using lifespan models to make predictions on new data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/BLR_normativemodel_protocol.html">Predictive Clinical Neuroscience Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/BLR_normativemodel_protocol.html#the-normative-modeling-framework-for-computational-psychiatry-protocol">The Normative Modeling Framework for Computational Psychiatry Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/BLR_normativemodel_protocol.html#data-preparation">Data Preparation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/BLR_normativemodel_protocol.html#algorithm-modeling">Algorithm &amp; Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/BLR_normativemodel_protocol.html#evaluation-interpretation">Evaluation &amp; Interpretation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/visualizations.html">Visualization of normative modeling outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/post_hoc_analysis.html">Post-hoc analysis on normative modeling outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/other_predictive_models.html">Load Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/other_predictive_models.html#create-train-test-splits">Create Train/Test Splits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/other_predictive_models.html#principal-component-regression-bbs">Principal Component Regression (BBS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/other_predictive_models.html#connectome-predictive-modelling">Connectome Predictive Modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/other_predictive_models.html#lasso-linear-regression-l1-regularization">Lasso (Linear Regression + L1 Regularization)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/other_predictive_models.html#ridge-linear-regression-l2-regularization">Ridge (Linear Regression + L2 Regularization)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/other_predictive_models.html#elastic-net-linear-regression-l1-l2-regularization">Elastic Net (Linear Regression + L1/L2 Regularization)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Useful Stuff</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pages/FAQs.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/citing.html">How to cite PCNtoolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/acknowledgements.html">Acknowledgements</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Predictive Clinical Neuroscience Toolkit</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">fileio</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for fileio</h1><div class="highlight"><pre>
<span></span>from __future__ import print_function

import os
import re
import sys
import tempfile

import nibabel as nib
import numpy as np
import pandas as pd

try:  # run as a package if installed
    from pcntoolkit import configs
except ImportError:
    pass

    path = os.path.abspath(os.path.dirname(__file__))
    path = os.path.dirname(path)  # parent directory
    if path not in sys.path:
        sys.path.append(path)
    del path
    import configs

CIFTI_MAPPINGS = (
    &quot;dconn&quot;,
    &quot;dtseries&quot;,
    &quot;pconn&quot;,
    &quot;ptseries&quot;,
    &quot;dscalar&quot;,
    &quot;dlabel&quot;,
    &quot;pscalar&quot;,
    &quot;pdconn&quot;,
    &quot;dpconn&quot;,
    &quot;pconnseries&quot;,
    &quot;pconnscalar&quot;,
)

CIFTI_VOL_ATLAS = &quot;Atlas_ROIs.2.nii.gz&quot;

PICKLE_PROTOCOL = configs.PICKLE_PROTOCOL

# ------------------------
# general utility routines
# ------------------------


<div class="viewcode-block" id="predictive_interval">
<a class="viewcode-back" href="../pages/modindex.html#fileio.predictive_interval">[docs]</a>
def predictive_interval(s2_forward, cov_forward, multiplicator):
    &quot;&quot;&quot;
    Calculates a predictive interval for the forward model
    &quot;&quot;&quot;
    # calculates a predictive interval

    PI = np.zeros(len(cov_forward))
    for i, xdot in enumerate(cov_forward):
        s = np.sqrt(s2_forward[i])
        PI[i] = multiplicator * s
    return PI</div>



<div class="viewcode-block" id="create_mask">
<a class="viewcode-back" href="../pages/modindex.html#fileio.create_mask">[docs]</a>
def create_mask(data_array, mask, verbose=False):
    &quot;&quot;&quot;
    Create a mask from a data array or a nifti file

    Basic usage::

            create_mask(data_array, mask, verbose)

    :param data_array: numpy array containing the data to write out
    :param mask: nifti image containing a mask for the image
    :param verbose: verbose output
    &quot;&quot;&quot;

    # create a (volumetric) mask either from an input nifti or the nifti itself

    if mask is not None:
        if verbose:
            print(&quot;Loading ROI mask ...&quot;)
        maskvol = load_nifti(mask, vol=True)
        maskvol = maskvol != 0
    else:
        if len(data_array.shape) &lt; 4:
            dim = data_array.shape[0:3] + (1,)
        else:
            dim = data_array.shape[0:3] + (data_array.shape[3],)

        if verbose:
            print(&quot;Generating mask automatically ...&quot;)
        if dim[3] == 1:
            maskvol = data_array[:, :, :] != 0
        else:
            maskvol = data_array[:, :, :, 0] != 0

    return maskvol</div>



<div class="viewcode-block" id="vol2vec">
<a class="viewcode-back" href="../pages/modindex.html#fileio.vol2vec">[docs]</a>
def vol2vec(dat, mask, verbose=False):
    &quot;&quot;&quot;
    Vectorise a 3d image

    Basic usage::

                vol2vec(dat, mask, verbose)

    :param dat: numpy array containing the data to write out
    :param mask: nifti image containing a mask for the image
    :param verbose: verbose output
    &quot;&quot;&quot;
    # vectorise a 3d image

    if len(dat.shape) &lt; 4:
        dim = dat.shape[0:3] + (1,)
    else:
        dim = dat.shape[0:3] + (dat.shape[3],)

    # mask = create_mask(dat, mask=mask, verbose=verbose)
    if mask is None:
        mask = create_mask(dat, mask=mask, verbose=verbose)

    # mask the image
    maskid = np.where(mask.ravel())[0]
    dat = np.reshape(dat, (np.prod(dim[0:3]), dim[3]))
    dat = dat[maskid, :]

    # convert to 1-d array if the file only contains one volume
    if dim[3] == 1:
        dat = dat.ravel()

    return dat</div>



<div class="viewcode-block" id="file_type">
<a class="viewcode-back" href="../pages/modindex.html#fileio.file_type">[docs]</a>
def file_type(filename):
    &quot;&quot;&quot;
    Determine the file type of a file

    Basic usage::

                    file_type(filename)

    :param filename: name of the file to check
    &quot;&quot;&quot;
    # routine to determine filetype

    if filename.endswith((&quot;.dtseries.nii&quot;, &quot;.dscalar.nii&quot;, &quot;.dlabel.nii&quot;)):
        ftype = &quot;cifti&quot;
    elif filename.endswith((&quot;.nii.gz&quot;, &quot;.nii&quot;, &quot;.img&quot;, &quot;.hdr&quot;)):
        ftype = &quot;nifti&quot;
    elif filename.endswith((&quot;.txt&quot;, &quot;.csv&quot;, &quot;.tsv&quot;, &quot;.asc&quot;)):
        ftype = &quot;text&quot;
    elif filename.endswith((&quot;.pkl&quot;)):
        ftype = &quot;binary&quot;
    else:
        raise ValueError(&quot;I don&#39;t know what to do with &quot; + filename)

    return ftype</div>



<div class="viewcode-block" id="file_extension">
<a class="viewcode-back" href="../pages/modindex.html#fileio.file_extension">[docs]</a>
def file_extension(filename):
    &quot;&quot;&quot;
    Determine the file extension of a file (e.g. .nii.gz)

    Basic usage::

                        file_extension(filename)

    :param filename: name of the file to check
    &quot;&quot;&quot;

    # routine to get the full file extension (e.g. .nii.gz, not just .gz)

    parts = filename.split(os.extsep)

    if parts[-1] == &quot;gz&quot;:
        if parts[-2] == &quot;nii&quot; or parts[-2] == &quot;img&quot; or parts[-2] == &quot;hdr&quot;:
            ext = parts[-2] + &quot;.&quot; + parts[-1]
        else:
            ext = parts[-1]
    elif parts[-1] == &quot;nii&quot;:
        if parts[-2] in CIFTI_MAPPINGS:
            ext = parts[-2] + &quot;.&quot; + parts[-1]
        else:
            ext = parts[-1]
    else:
        ext = parts[-1]

    ext = &quot;.&quot; + ext
    return ext</div>



<div class="viewcode-block" id="file_stem">
<a class="viewcode-back" href="../pages/modindex.html#fileio.file_stem">[docs]</a>
def file_stem(filename):
    &quot;&quot;&quot;
    Determine the file stem of a file (e.g. /path/to/file.nii.gz -&gt; file)

    Basic usage::

                                file_stem(filename)

    :param filename: name of the file to check
    &quot;&quot;&quot;
    idx = filename.find(file_extension(filename))
    stm = filename[0:idx]

    return stm</div>



# --------------
# nifti routines
# --------------


<div class="viewcode-block" id="load_nifti">
<a class="viewcode-back" href="../pages/modindex.html#fileio.load_nifti">[docs]</a>
def load_nifti(datafile, mask=None, vol=False, verbose=False):
    &quot;&quot;&quot;
    Load a nifti file into a numpy array

    Basic usage::

                    load_nifti(datafile, mask, vol, verbose)

    :param datafile: name of the file to load
    :param mask: nifti image containing a mask for the image
    :param vol: whether to load the image as a volume
    :param verbose: verbose output
    &quot;&quot;&quot;

    if verbose:
        print(&quot;Loading nifti: &quot; + datafile + &quot; ...&quot;)
    img = nib.load(datafile)
    dat = img.get_fdata()

    if mask is not None:
        mask = load_nifti(mask, vol=True)

    if not vol:
        dat = vol2vec(dat, mask)

    return dat</div>



<div class="viewcode-block" id="save_nifti">
<a class="viewcode-back" href="../pages/modindex.html#fileio.save_nifti">[docs]</a>
def save_nifti(data, filename, examplenii, mask, dtype=None):
    &quot;&quot;&quot;
    Write output to nifti

    Basic usage::

        save_nifti(data, filename mask, dtype)

    :param data: numpy array containing the data to write out
    :param filename: where to store it
    :param examplenii: nifti to copy the geometry and data type from
    :mask: nifti image containing a mask for the image
    :param dtype: data type for the output image (if different from the image)
    &quot;&quot;&quot;

    # load mask
    if isinstance(mask, str):
        mask = load_nifti(mask, vol=True)
        mask = mask != 0

    # load example image
    ex_img = nib.load(examplenii)
    ex_img.shape
    dim = ex_img.shape[0:3]
    if len(data.shape) &lt; 2:
        nvol = 1
        data = data[:, np.newaxis]
    else:
        nvol = int(data.shape[1])

    # write data
    array_data = np.zeros((np.prod(dim), nvol))
    array_data[mask.flatten(), :] = data
    array_data = np.reshape(array_data, dim + (nvol,))
    hdr = ex_img.header
    if dtype is not None:
        hdr.set_data_dtype(dtype)
        array_data = array_data.astype(dtype)
    array_img = nib.Nifti1Image(array_data, ex_img.affine, hdr)

    nib.save(array_img, filename)</div>



# --------------
# cifti routines
# --------------


<div class="viewcode-block" id="load_cifti">
<a class="viewcode-back" href="../pages/modindex.html#fileio.load_cifti">[docs]</a>
def load_cifti(filename, vol=False, mask=None, rmtmp=True):
    &quot;&quot;&quot;
    Load a cifti file into a numpy array

    Basic usage::

                        load_cifti(filename, vol, mask, rmtmp)

    :param filename: name of the file to load
    :param vol: whether to load the image as a volume
    :param mask: nifti image containing a mask for the image
    :param rmtmp: whether to remove temporary files
    &quot;&quot;&quot;
    # parse the name
    dnam, fnam = os.path.split(filename)
    fpref = file_stem(fnam)
    outstem = os.path.join(tempfile.gettempdir(), str(os.getpid()) + &quot;-&quot; + fpref)

    # extract surface data from the cifti file
    print(&quot;Extracting cifti surface data to &quot;, outstem, &quot;-*.func.gii&quot;, sep=&quot;&quot;)
    giinamel = outstem + &quot;-left.func.gii&quot;
    giinamer = outstem + &quot;-right.func.gii&quot;
    os.system(
        &quot;wb_command -cifti-separate &quot;
        + filename
        + &quot; COLUMN -metric CORTEX_LEFT &quot;
        + giinamel
    )
    os.system(
        &quot;wb_command -cifti-separate &quot;
        + filename
        + &quot; COLUMN -metric CORTEX_RIGHT &quot;
        + giinamer
    )

    # load the surface data
    giil = nib.load(giinamel)
    giir = nib.load(giinamer)
    Nimg = len(giil.darrays)
    Nvert = len(giil.darrays[0].data)
    if Nimg == 1:
        out = np.concatenate((giil.darrays[0].data, giir.darrays[0].data), axis=0)
    else:
        Gl = np.zeros((Nvert, Nimg))
        Gr = np.zeros((Nvert, Nimg))
        for i in range(0, Nimg):
            Gl[:, i] = giil.darrays[i].data
            Gr[:, i] = giir.darrays[i].data
        out = np.concatenate((Gl, Gr), axis=0)
    if rmtmp:
        # clean up temporary files
        os.remove(giinamel)
        os.remove(giinamer)

    if vol:
        niiname = outstem + &quot;-vol.nii&quot;
        print(&quot;Extracting cifti volume data to &quot;, niiname, sep=&quot;&quot;)
        os.system(
            &quot;wb_command -cifti-separate &quot; + filename + &quot; COLUMN -volume-all &quot; + niiname
        )
        vol = load_nifti(niiname, vol=True)
        volmask = create_mask(vol)
        out = np.concatenate((out, vol2vec(vol, volmask)), axis=0)
        if rmtmp:
            os.remove(niiname)

    return out</div>



<div class="viewcode-block" id="save_cifti">
<a class="viewcode-back" href="../pages/modindex.html#fileio.save_cifti">[docs]</a>
def save_cifti(data, filename, example, mask=None, vol=True, volatlas=None):
    &quot;&quot;&quot;
    Save a cifti file from a numpy array

    Basic usage::

                            save_cifti(data, filename, example, mask, vol, volatlas)

    :param data: numpy array containing the data to write out
    :param filename: where to store it
    :param example: example file to copy the geometry from
    :param mask: nifti image containing a mask for the image
    :param vol: whether to load the image as a volume
    :param volatlas: atlas to use for the volume
    &quot;&quot;&quot;

    # do some sanity checks
    if data.dtype == &quot;float32&quot; or data.dtype == &quot;float&quot; or data.dtype == &quot;float64&quot;:
        data = data.astype(&quot;float32&quot;)  # force 32 bit output
        dtype = &quot;NIFTI_TYPE_FLOAT32&quot;
    else:
        raise ValueError(&quot;Only float data types currently handled&quot;)

    if len(data.shape) == 1:
        Nimg = 1
        data = data[:, np.newaxis]
    else:
        Nimg = data.shape[1]

    # get the base filename
    dnam, fnam = os.path.split(filename)
    fstem = file_stem(fnam)

    # Split the template
    estem = os.path.join(tempfile.gettempdir(), str(os.getpid()) + &quot;-&quot; + fstem)
    giiexnamel = estem + &quot;-left.func.gii&quot;
    giiexnamer = estem + &quot;-right.func.gii&quot;
    os.system(
        &quot;wb_command -cifti-separate &quot;
        + example
        + &quot; COLUMN -metric CORTEX_LEFT &quot;
        + giiexnamel
    )
    os.system(
        &quot;wb_command -cifti-separate &quot;
        + example
        + &quot; COLUMN -metric CORTEX_RIGHT &quot;
        + giiexnamer
    )

    # write left hemisphere
    giiexl = nib.load(giiexnamel)
    Nvertl = len(giiexl.darrays[0].data)
    garraysl = []
    for i in range(0, Nimg):
        garraysl.append(
            nib.gifti.gifti.GiftiDataArray(data=data[0:Nvertl, i], datatype=dtype)
        )
    giil = nib.gifti.gifti.GiftiImage(darrays=garraysl)
    fnamel = fstem + &quot;-left.func.gii&quot;
    nib.save(giil, fnamel)

    # write right hemisphere
    giiexr = nib.load(giiexnamer)
    Nvertr = len(giiexr.darrays[0].data)
    garraysr = []
    for i in range(0, Nimg):
        garraysr.append(
            nib.gifti.gifti.GiftiDataArray(
                data=data[Nvertl : Nvertl + Nvertr, i], datatype=dtype
            )
        )
    giir = nib.gifti.gifti.GiftiImage(darrays=garraysr)
    fnamer = fstem + &quot;-right.func.gii&quot;
    nib.save(giir, fnamer)

    tmpfiles = [fnamer, fnamel, giiexnamel, giiexnamer]

    # process volumetric data
    if vol:
        niiexname = estem + &quot;-vol.nii&quot;
        os.system(
            &quot;wb_command -cifti-separate &quot; + example + &quot; COLUMN -volume-all &quot; + niiexname
        )
        niivol = load_nifti(niiexname, vol=True)
        if mask is None:
            mask = create_mask(niivol)

        if volatlas is None:
            volatlas = CIFTI_VOL_ATLAS
        fnamev = fstem + &quot;-vol.nii&quot;

        save_nifti(data[Nvertr + Nvertl :, :], fnamev, niiexname, mask)
        tmpfiles.extend([fnamev, niiexname])

    # write cifti
    fname = fstem + &quot;.dtseries.nii&quot;
    os.system(
        &quot;wb_command -cifti-create-dense-timeseries &quot;
        + fname
        + &quot; -volume &quot;
        + fnamev
        + &quot; &quot;
        + volatlas
        + &quot; -left-metric &quot;
        + fnamel
        + &quot; -right-metric &quot;
        + fnamer
    )

    # clean up
    for f in tmpfiles:
        os.remove(f)</div>



# --------------
# ascii routines
# --------------


<div class="viewcode-block" id="load_pd">
<a class="viewcode-back" href="../pages/modindex.html#fileio.load_pd">[docs]</a>
def load_pd(filename):
    &quot;&quot;&quot;
    Load a csv file into a pandas dataframe

    Basic usage::

                    load_pd(filename)

    :param filename: name of the file to load
    &quot;&quot;&quot;

    # based on pandas
    x = pd.read_csv(filename, sep=&quot; &quot;, header=None)
    return x</div>



<div class="viewcode-block" id="save_pd">
<a class="viewcode-back" href="../pages/modindex.html#fileio.save_pd">[docs]</a>
def save_pd(data, filename):
    &quot;&quot;&quot;
    Save a pandas dataframe to a csv file

    Basic usage::

        save_pd(data, filename)

    :param data: pandas dataframe containing the data to write out
    :param filename: where to store it
    &quot;&quot;&quot;
    # based on pandas
    data.to_csv(filename, index=None, header=None, sep=&quot; &quot;, na_rep=&quot;NaN&quot;)</div>



<div class="viewcode-block" id="load_ascii">
<a class="viewcode-back" href="../pages/modindex.html#fileio.load_ascii">[docs]</a>
def load_ascii(filename):
    &quot;&quot;&quot;
    Load an ascii file into a numpy array

    Basic usage::

            load_ascii(filename)

    :param filename: name of the file to load
    &quot;&quot;&quot;

    # based on pandas
    x = np.loadtxt(filename)
    return x</div>



<div class="viewcode-block" id="save_ascii">
<a class="viewcode-back" href="../pages/modindex.html#fileio.save_ascii">[docs]</a>
def save_ascii(data, filename):
    &quot;&quot;&quot;
    Save a numpy array to an ascii file

    Basic usage::

        save_ascii(data, filename)

    :param data: numpy array containing the data to write out
    :param filename: where to store it
    &quot;&quot;&quot;
    # based on pandas
    np.savetxt(filename, data)</div>



# ----------------
# generic routines
# ----------------


<div class="viewcode-block" id="save">
<a class="viewcode-back" href="../pages/modindex.html#fileio.save">[docs]</a>
def save(data, filename, example=None, mask=None, text=False, dtype=None):
    &quot;&quot;&quot;
    Save a numpy array to a file

    Basic usage::

                save(data, filename, example, mask, text, dtype)

    :param data: numpy array containing the data to write out
    :param filename: where to store it
    :param example: example file to copy the geometry from
    :param mask: nifti image containing a mask for the image
    :param text: whether to write out a text file
    :param dtype: data type for the output image (if different from the image)
    &quot;&quot;&quot;

    if file_type(filename) == &quot;cifti&quot;:
        save_cifti(data.T, filename, example, vol=True)
    elif file_type(filename) == &quot;nifti&quot;:
        save_nifti(data.T, filename, example, mask, dtype=dtype)
    elif text or file_type(filename) == &quot;text&quot;:
        save_ascii(data, filename)
    elif file_type(filename) == &quot;binary&quot;:
        data = pd.DataFrame(data)
        data.to_pickle(filename, protocol=PICKLE_PROTOCOL)</div>



<div class="viewcode-block" id="load">
<a class="viewcode-back" href="../pages/modindex.html#fileio.load">[docs]</a>
def load(filename, mask=None, text=False, vol=True):
    &quot;&quot;&quot;
    Load a numpy array from a file

    Basic usage::

                    load(filename, mask, text, vol)

    :param filename: name of the file to load
    :param mask: nifti image containing a mask for the image
    :param text: whether to write out a text file
    :param vol: whether to load the image as a volume
    &quot;&quot;&quot;

    if file_type(filename) == &quot;cifti&quot;:
        x = load_cifti(filename, vol=vol)
    elif file_type(filename) == &quot;nifti&quot;:
        x = load_nifti(filename, mask, vol=vol)
    elif text or file_type(filename) == &quot;text&quot;:
        x = load_ascii(filename)
    elif file_type(filename) == &quot;binary&quot;:
        x = pd.read_pickle(filename)
        x = x.to_numpy()
    return x</div>



# -------------------
# sorting routines for batched in normative parallel
# -------------------


<div class="viewcode-block" id="tryint">
<a class="viewcode-back" href="../pages/modindex.html#fileio.tryint">[docs]</a>
def tryint(s):
    &quot;&quot;&quot;
    Try to convert a string to an integer

    Basic usage::

                    tryint(s)

    :param s: string to convert
    &quot;&quot;&quot;

    try:
        return int(s)
    except ValueError:
        return s</div>



<div class="viewcode-block" id="alphanum_key">
<a class="viewcode-back" href="../pages/modindex.html#fileio.alphanum_key">[docs]</a>
def alphanum_key(s):
    &quot;&quot;&quot;
    Turn a string into a list of numbers

    Basic usage::

                    alphanum_key(s)

    :param s: string to convert
    &quot;&quot;&quot;
    return [tryint(c) for c in re.split(&quot;([0-9]+)&quot;, s)]</div>



<div class="viewcode-block" id="sort_nicely">
<a class="viewcode-back" href="../pages/modindex.html#fileio.sort_nicely">[docs]</a>
def sort_nicely(l):
    &quot;&quot;&quot;
    Sort a list of strings in a natural way

    Basic usage::

        sort_nicely(l)

    :param l: list of strings to sort
    &quot;&quot;&quot;

    return sorted(l, key=alphanum_key)</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Andre F. Marquand.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>